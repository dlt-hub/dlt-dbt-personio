/* Table: employees */
{{
    config(
        materialized='view'
    )
}}
-- depends_on: {{ ref('dlt_active_load_ids') }}

SELECT
/* select which columns will be available for table 'employees' */
    id,
    first_name,
    last_name,
    preferred_name,
    email,
    gender,
    status,
    position,
    employment_type,
    weekly_working_hours,
    termination_type,
    termination_reason,
    created_at,
    last_modified_at,
    holiday_calendar__type,
    holiday_calendar__attributes__id,
    holiday_calendar__attributes__name,
    holiday_calendar__attributes__country,
    work_schedule__type,
    work_schedule__attributes__id,
    work_schedule__attributes__name,
    work_schedule__attributes__monday,
    work_schedule__attributes__tuesday,
    work_schedule__attributes__wednesday,
    work_schedule__attributes__thursday,
    work_schedule__attributes__friday,
    work_schedule__attributes__saturday,
    work_schedule__attributes__sunday,
    fix_salary,
    fix_salary_interval,
    hourly_salary,
    national_insurance_number,
    holder_of_bank_account,
    emergency_contact_name,
    address,
    key_number_id,
    type_of_visa,
    iban,
    emergency_contact_phone_number,
    marital_status,
    city,
    laptop_serial_number,
    trainings,
    employee_id,
    type_of_health_insurance,
    bic,
    postcode,
    emergency_contact_relationship_to_the_employee,
    language_skills,
    name_of_health_insurance,
    personal_email,
    linkedin,
    first_aider,
    main_or_secondary_occupation,
    child_allowance,
    nationality,
    salary_type,
    notice_period,
    occupation_type,
    project_manager,
    mentor,
    _dlt_load_id,
    _dlt_id,
    supervisor__type,
    supervisor__attributes__id__label,
    supervisor__attributes__id__value,
    supervisor__attributes__id__type,
    supervisor__attributes__id__universal_id,
    supervisor__attributes__first_name__label,
    supervisor__attributes__first_name__value,
    supervisor__attributes__first_name__type,
    supervisor__attributes__first_name__universal_id,
    supervisor__attributes__last_name__label,
    supervisor__attributes__last_name__value,
    supervisor__attributes__last_name__type,
    supervisor__attributes__last_name__universal_id,
    supervisor__attributes__preferred_name__label,
    supervisor__attributes__preferred_name__value,
    supervisor__attributes__preferred_name__type,
    supervisor__attributes__preferred_name__universal_id,
    supervisor__attributes__email__label,
    supervisor__attributes__email__value,
    supervisor__attributes__email__type,
    supervisor__attributes__email__universal_id,
    hire_date,
    probation_period_end,
    subcompany__type,
    subcompany__attributes__id,
    subcompany__attributes__name,
    office__type,
    office__attributes__id,
    office__attributes__name,
    department__type,
    department__attributes__id,
    department__attributes__name,
    work_schedule__attributes__valid_from,
    profile_picture,
    team__type,
    team__attributes__id,
    team__attributes__name,
    date_of_birth,
    contract_end_date,
    visa_expiry_date,
FROM {{ source('raw_data', 'employees') }}

/* we only load table items of the currently active load ids into the staging table */
WHERE _dlt_load_id IN ( SELECT load_id FROM  {{ ref('dlt_active_load_ids') }} )